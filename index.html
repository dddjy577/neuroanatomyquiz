<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuroanatomy Quiz by Oben</title>
    <style>
        /* --- COLOR VARIABLES (UPDATED FOR DARK MODE) --- */
        :root {
            --primary-color: #b000b2; /* Main button color */
            --primary-hover: #8e0090; /* Darker shade for hover */
            --secondary-color: #b000b2; /* Next button color */
            --secondary-hover: #8e0090; /* Darker shade for hover */
            --success-color: #b000b2; /* Submit button (used for Correct feedback too) */
            --success-hover: #8e0090; /* Darker shade for hover */
            --danger-color: #dc3545; /* Red for Wrong feedback */
            --bg-color: #000000; /* TOTALLY BLACK BACKGROUND */
            --card-bg: #111111; /* Dark gray for the main container */
            --border-color: #333333; /* Darker border color */
            --text-color: #ffffff; /* WHITE TEXT */
            --info-bar-bg: #222222; /* Darker background for the info bar */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color); /* Apply white text color */
            text-align: center;
        }

        #quiz-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); /* Darker shadow for contrast */
            padding: 30px;
        }

        h1 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: var(--text-color);
        }

        #info-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-weight: bold;
            font-size: 1.1em;
            padding: 10px;
            background-color: var(--info-bar-bg);
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1em;
            font-weight: 600;
            color: var(--text-color); /* White text on all buttons */
        }

        .start-button {
            background-color: var(--primary-color);
            width: 150px;
            height: 50px;
        }

        .start-button:hover {
            background-color: var(--primary-hover);
        }

        #image-display img {
            max-width: 100%;
            height: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 20px;
        }

        #question-area {
            margin-bottom: 20px;
        }
        
        /* Style for the new End Quiz button */
        #end-button {
            background-color: #8e0090; /* A darker shade of the theme color to look distinct */
            margin-top: 15px; 
            width: 100%;
            max-width: 480px;
            display: block; /* Make it take its own row */
            margin-left: auto;
            margin-right: auto;
        }
        #end-button:hover {
            background-color: #5d005e;
        }

        /* Styles for the new Set Jumper */
        #set-jumper {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 2px solid var(--primary-color); /* Added a separator line */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #set-jumper-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        #set-jumper-controls select {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background-color: var(--info-bar-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            min-width: 150px; /* Ensures space for the text */
        }
        .go-button { /* Applied start-button styling class */
            background-color: var(--primary-color);
            height: 50px;
            width: 150px;
            padding: 10px 20px;
        }
        .go-button:hover {
            background-color: var(--primary-hover);
        }


        #answer-input {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 80%;
            max-width: 300px;
            margin-right: 10px;
            background-color: var(--info-bar-bg); /* Darker input background */
            color: var(--text-color);
        }

        #submit-button {
            background-color: var(--success-color);
        }
        #submit-button:hover {
            background-color: var(--success-hover);
        }

        #next-button {
            background-color: var(--secondary-color);
        }
        #next-button:hover {
            background-color: var(--secondary-hover);
        }

        #result-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            min-height: 40px;
        }
        /* Adjusted feedback colors for better visibility on a dark background */
        .correct {
            background-color: #004d00; /* Dark Green */
            color: #7aff7a; /* Light Green text */
        }
        .wrong {
            background-color: #6d0000; /* Dark Red */
            color: #ff7a7a; /* Light Red text */
        }
    </style>
</head>
<body>

    <div id="quiz-container">
        <h1>Neuroanatomy Quiz by Oben üß†</h1>

        <div id="start-screen">
            <h2>Select Quiz Mode (Starts at Set 1)</h2>
            <button class="start-button" onclick="startQuiz('ordered')">Ordered</button>
            <button class="start-button" onclick="startQuiz('random')">Random</button>
            
            <div id="set-jumper">
                <h3>Jump to Set (Starts Ordered from Set)</h3>
                <div id="set-jumper-controls">
                    <select id="set-dropdown">
                        </select>
                    <button class="go-button" onclick="jumpToSet()">Go</button>
                </div>
            </div>
            </div>

        <div id="quiz-screen" style="display: none;">
            <div id="info-bar">
                <span id="score">Correct: 0</span>
                <span id="progress">Question: 0/0</span>
            </div>

            <div id="image-display">
                </div>

            <div id="question-area">
                <p id="question-text"></p>
                <input type="text" id="answer-input" placeholder="Enter your answer">
                <button id="submit-button" onclick="checkAnswer()">Submit</button>
                <button id="next-button" style="display:none;" onclick="nextQuestion()">Next Question</button>
                <button id="end-button" onclick="endQuizEarly()">End Quiz</button>
            </div>

            <div id="result-message">
                </div>
        </div>
    </div>

    <script>
        // Data parsed from the uploaded document
        const QUIZ_DATA = [
            { set: 1, label: '1', answer: 'caput nucleus caudatus' },
            { set: 1, label: '2', answer: 'cauda nucleus caudatus' },
            { set: 1, label: '3', answer: 'nucleus lentiformis' },
            { set: 1, label: '4', answer: 'thalamus sin.' },
            { set: 1, label: '5', answer: 'thalamus dx.' },
            { set: 1, label: '6', answer: 'ventriculus III' },
            { set: 2, label: '1', answer: 'ventr. lat. cornu ant.' },
            { set: 2, label: '2', answer: 'ventr. lat. cornu inf.' },
            { set: 2, label: '3', answer: 'septum pellucidum' },
            { set: 2, label: '4', answer: 'ventriculus III' },
            { set: 2, label: '5', answer: 'capsula interna' },
            { set: 2, label: '6', answer: 'thalamus' },
            { set: 2, label: '7', answer: 'corpus callosum' },
            { set: 2, label: '8', answer: 'fornix' },
            { set: 2, label: '9', answer: 'globus pallidus' },
            { set: 2, label: '10', answer: 'putamen' },
            { set: 2, label: '11', answer: 'claustrum' },
            { set: 2, label: '12', answer: 'insula' },
            { set: 2, label: '13', answer: 'caput nucleus caudatus' },
            { set: 2, label: '14', answer: 'cauda nucleus caudatus' },
            { set: 3, label: '1', answer: 'corpus callosum' },
            { set: 3, label: '2', answer: 'septum pellucidum' },
            { set: 3, label: '3', answer: 'fornix' },
            { set: 3, label: '4', answer: 'commissura anterior' },
            { set: 3, label: '5', answer: 'commissura posterior' },
            { set: 3, label: '6', answer: 'plexus choroideus ventr. III' },
            { set: 3, label: '7', answer: 'hypothalamus' },
            { set: 3, label: '8', answer: 'thalamus' },
            { set: 3, label: '9', answer: 'corpus mammillare' },
            { set: 3, label: '10', answer: 'foramen interventriculare' },
            { set: 3, label: '11', answer: 'ventriculus IV' },
            { set: 3, label: '12', answer: 'plexus choroideus ventr. IV' },
            { set: 3, label: '13', answer: 'aqueductus cerebri' },
            { set: 3, label: '14', answer: 'corpus pineale' },
            { set: 3, label: '15', answer: 'mesencephalon' },
            { set: 3, label: '16', answer: 'pons' },
            { set: 4, label: '1', answer: 'ventr. lat. cornu posterius' },
            { set: 4, label: '2', answer: 'ventr. lat. pars centralis' },
            { set: 4, label: '3', answer: 'ventr. lat. cornu anterius' },
            { set: 4, label: '4', answer: 'aqueductus cerebri' },
            { set: 4, label: '5', answer: 'venr. lat. cornu laterale' },
            { set: 4, label: '6', answer: 'ventriculus IV' },
            { set: 4, label: '7', answer: 'canalis centralis' },
            { set: 4, label: '8', answer: 'aperturae lat. ventr. IV' },
            { set: 4, label: '9', answer: 'apertura med. ventr. IV' },
            { set: 4, label: '10', answer: 'ventriculus III' },
            { set: 4, label: '11', answer: 'foramen interventriculare' },
            { set: 4, label: '12', answer: 'adhesio intrathalamica' },
            { set: 5, label: 'a', answer: 'Medial geniculate nucleus' },
            { set: 5, label: 'b', answer: 'Lateral geniculate nucleus' },
            { set: 5, label: 'c', answer: 'Aqueductus cerebri' },
            { set: 5, label: 'd', answer: 'Crus cerebri' },
            { set: 5, label: 'e', answer: 'Substantia nigra' },
            { set: 5, label: 'f', answer: 'Nucleus raphne' },
            { set: 5, label: 'g', answer: 'Nucleus ruber' },
            { set: 5, label: 'h', answer: 'Nervus Oculomotorius' },
            { set: 5, label: 'i', answer: 'Colliculus superior' },
            { set: 5, label: 'j', answer: 'Periaquaductal gray' },
            { set: 5, label: 'k', answer: 'Basis pedunculi = crus cerebri, substantia nigra' },
            { set: 5, label: 'L*', answer: 'Tectum = Superior colliculus, inferior colliculus' },
            { set: 5, label: 'M*', answer: 'Tegmentum = Red nucleus, Periaqueductal gray, Reticular formation, Cranial nerve nuclei, ascending/descending pathways (except CST/CBT)' },
            { set: 5, label: 'N*', answer: 'Pedunculus cerebri = tegmentum, basis pedunculi, pretectum' },
            { set: 6, label: 'a', answer: 'Dorsal motor nucleus of vagus' },
            { set: 6, label: 'b', answer: 'CN V sensory nuclei' },
            { set: 6, label: 'c', answer: 'Inferior olivary nucleus' },
            { set: 6, label: 'd', answer: 'Corticospinal fibers in the pyramid' },
            { set: 6, label: 'e', answer: 'Medial lemniscus' },
            { set: 6, label: 'f', answer: 'Spinothalamic tract' },
            { set: 6, label: 'g', answer: 'Inferior cerebellar peduncle' },
            { set: 6, label: 'h', answer: 'Tectospinal tract' },
            { set: 6, label: 'i', answer: 'Hypoglossal nuclei' },
            { set: 6, label: 'j', answer: 'Medial longitudinal fasciculus' },
            { set: 7, label: '1', answer: 'sulcus centralis' },
            { set: 7, label: '2', answer: 'sulcus lateralis' },
            { set: 7, label: '3', answer: 'sulcus parieto-occipitalis' },
            { set: 7, label: '4', answer: 'gyrus precentralis' },
            { set: 7, label: '5', answer: 'gyrus postcentralis' },
            { set: 7, label: '6', answer: 'gyrus temporalis superior' },
            { set: 7, label: '7', answer: 'gyrus temporalis media' },
            { set: 7, label: '8', answer: 'gyrus temporalis inferior' },
            { set: 8, label: '1', answer: 'fissura longitudinalis' },
            { set: 8, label: '2', answer: 'bulbus olfactorius' },
            { set: 8, label: '3', answer: 'tractus olfactorius' },
            { set: 8, label: '4', answer: 'chiasma opticum' },
            { set: 8, label: '5', answer: 'infundibulum' },
            { set: 8, label: '6', answer: 'corpus mamillare' },
            { set: 8, label: '7', answer: 'pons' },
            { set: 8, label: '8', 'answer': 'pyramis' },
            { set: 8, label: '9', answer: 'flocculus' },
            { set: 8, label: '10', answer: 'vermis cerebelli' },
            { set: 8, label: '11', answer: 'oliva' },
            { set: 8, label: '12', answer: 'gyrus temporalis inferior' },
            { set: 8, label: '13', answer: 'gyrus parahippocampalis' },
            { set: 8, label: '14', answer: 'gyri orbitales' },
            { set: 8, label: '15', answer: 'sulci orbitales' },
            { set: 9, label: '1', answer: 'gyrus cinguli' },
            { set: 9, label: '2', answer: 'corpus callosum' },
            { set: 9, label: '3', answer: 'sulcus calcarinus' },
            { set: 9, label: '4', answer: 'commissura anterior' },
            { set: 9, label: '5', answer: 'fornix' },
            { set: 9, label: '6', answer: 'corpus pineale (epiphysis)' },
            { set: 9, label: '7', answer: 'Telencephalon' },
            { set: 9, label: '8', answer: 'Diencephalon' },
            { set: 9, label: '9', answer: 'Mesencephalon' },
            { set: 9, label: '10', answer: 'Pons' },
            { set: 9, label: '11', answer: 'Medulla oblongata' },
            { set: 9, label: '12', answer: 'Medulla spinalis' },
            { set: 9, label: '13', answer: 'Cerebellum' },
            { set: 10, label: '1', answer: 'fissura longitudinalis cerebri' },
            { set: 10, label: '2', answer: 'corpus callosum' },
            { set: 10, label: '3', answer: 'septum pellucidum' },
            { set: 10, label: '4', answer: 'fornix' },
            { set: 10, label: '5', answer: 'sulcus lateralis' },
            { set: 10, label: '6', answer: 'insula' },
            { set: 10, label: '7', answer: 'corpus mammillare' },
            { set: 10, label: '8', answer: 'ventr. lat. pars centralis' },
            { set: 10, label: '9', answer: 'ventr. lat. cornu inferius (laterale)' },
            { set: 10, label: '10', answer: 'ventriculus III' },
            { set: 10, label: '11', answer: 'plexus choroideus ventr. lat.' },
            { set: 10, label: '12', answer: 'plexus choroideus ventr. III' },
            { set: 10, label: '13', answer: 'thalamus' },
            { set: 10, label: '14', answer: 'hypothalamus' },
            { set: 10, label: '15', answer: 'nucleus caudatus' },
            { set: 10, label: '16', answer: 'claustrum' },
            { set: 10, label: '17', answer: 'putamen' },
            { set: 10, label: '18', answer: 'globus pallidus' },
            { set: 10, label: '19', answer: 'capsula interna' },
            { set: 10, label: '20', answer: 'lobus temporalis' },
            { set: 10, label: '21', answer: 'pedunculus cerebri' },
            { set: 11, label: '1', answer: 'pedunculus cerebelli inf' },
            { set: 11, label: '2', answer: 'aperturae laterales ventr. IV' },
            { set: 11, label: '3', answer: 'pedunculus cerebelli media' },
            { set: 11, label: '4', answer: 'pedunculus cerebelli sup' },
            { set: 11, label: '5', answer: 'nervus trochlearis (n. IV)' },
            { set: 11, label: '6', answer: 'colliculus inferior' },
            { set: 11, label: '7', answer: 'colliculus superior' },
            { set: 11, label: '8', answer: 'corpus geniculatum laterale' },
            { set: 11, label: '9', answer: 'corpus geniculatum mediale' },
            { set: 11, label: '10', answer: 'thalamus' },
            { set: 11, label: '11', answer: 'corpus pineale' },
            { set: 11, label: '12', answer: 'ventriculus III' },
            { set: 11, label: '13', answer: 'tuberculum cuneatus' },
            { set: 11, label: '14', answer: 'tuberculum gracilis' },
            { set: 11, label: '15', answer: 'fasciculus gracilis' },
            { set: 11, label: '16', answer: 'fasciculus cuneatus' },
            { set: 12, label: '1', answer: 'Vermis' },
            { set: 12, label: '2', answer: 'tonsilla cerebelli' },
            { set: 12, label: '3', answer: 'lobus flocculo-nodularis' },
            { set: 12, label: '4', answer: 'pedunculus cerebelli superior' },
            { set: 12, label: '5', answer: 'pedunculus cerebelli media' },
            { set: 12, label: '6', answer: 'pedunculus cerebelli inferioir' },
            { set: 13, label: '1', answer: 'n. oculomotorius (III)' },
            { set: 13, label: '2', answer: 'n. trochlearis (IV)' },
            { set: 13, label: '3', answer: 'n. trigeminus (V)' },
            { set: 13, label: '4', answer: 'n. abducens (VI)' },
            { set: 13, label: '5', answer: 'n. facialis (VII)' },
            { set: 13, label: '6', answer: 'n. vestibulo-cochlearis (VIII)' },
            { set: 13, label: '7', answer: 'n. glossopharyngeus (IX)' },
            { set: 13, label: '8', answer: 'n. vagus (X)' },
            { set: 13, label: '9', answer: 'n. accessorius (XI)' },
            { set: 13, label: '10', answer: 'n. hypoglossus (XII)' },
            { set: 13, label: '11', answer: 'pedunculus cerebri' },
            { set: 13, label: '12', answer: 'fossa interpeduncularis' },
            { set: 13, label: '13', answer: 'pyramis' },
            { set: 13, label: '14', answer: 'oliva' },
            { set: 13, label: '15', answer: 'infundibulum (hypophysis)' },
            { set: 13, label: '16', answer: 'pons' },
            { set: 13, label: '17', answer: 'corpus mammillare' },
            { set: 13, label: '18', answer: 'floccus' },
            { set: 14, label: '1', answer: 'nucleus dentatus' },
            { set: 14, label: '2', answer: 'nucleus fastigii' },
            { set: 14, label: '3', answer: 'nucleus interpositus' },
            { set: 14, label: '4', answer: 'ventriculus IV' },
            { set: 14, label: '5', answer: 'pons' },
            { set: 14, label: '6', answer: 'flocculus' },
            { set: 15, label: '1', answer: 'gyrus postcentralis' },
            { set: 15, label: '2', answer: 'gyrus precentralis' },
            { set: 15, label: '3', answer: 'sulcus centralis' },
            { set: 15, label: '4', answer: 'corona radiata' },
            { set: 15, label: '5', answer: 'capsula interna' },
            { set: 16, label: '1', answer: 'fasciculus gracilis' },
            { set: 16, label: '2', answer: 'fasciculus cuneatus' },
            { set: 16, label: '3', answer: 'funiculus posterior' },
            { set: 16, label: '4', answer: 'funiculus lateralis' },
            { set: 16, label: '5', answer: 'funiculus anterior' },
            { set: 16, label: '6', answer: 'commissura anterior' },
            { set: 16, label: '7', answer: 'fissura mediana anterior' },
            { set: 16, label: '8', answer: 'cornu posterius' },
            { set: 16, label: '9', answer: 'cornu anterius' },
            { set: 16, label: '10', answer: 'cornu laterale' },
            { set: 16, label: '11', answer: 'canalis centralis' },
            { set: 17, label: '1', answer: '√ñVRE a. cerebri media' },
            { set: 17, label: '2', answer: 'UNDRE a. cerebri media' },
            { set: 17, label: '3', answer: '√ñVRE a. cerebri ant.' },
            { set: 17, label: '4', answer: 'UNDRE a. cerebri ant.' },
            { set: 17, label: '5', answer: '√ñVRE a cerebri post' },
            { set: 17, label: '6', answer: 'UNDRE a cerebri post' },
            { set: 17, label: '7', answer: '√ñVRE a cerebelli sup' },
            { set: 17, label: '8', answer: 'UNDRE a cerebelli sup' },
            { set: 17, label: '9', answer: '√ñVRE a cerebelli inferior ant. (AICA)' },
            { set: 17, label: '10', answer: 'UNDRE a cerebelli inferior post. (PICA)' },
            { set: 17, label: '11', answer: '√ñVRE a cerebelli inferior post. (PICA)' },
            { set: 17, label: '12', answer: '√ñVRE a basilaris' },
            { set: 17, label: '13', answer: 'UNDRE a basilaris' },
            { set: 18, label: '1', answer: 'a communicants ant.' },
            { set: 18, label: '2', answer: 'a cerebri ant.' },
            { set: 18, label: '3', answer: 'a carotis interna' },
            { set: 18, label: '4', answer: 'a basilaris' },
            { set: 18, label: '5', answer: 'a spinalis ant.' },
            { set: 18, label: '6', answer: 'a communicants post.' },
            { set: 18, label: '7', answer: 'a cerebri post.' },
            { set: 18, label: '8', answer: 'a cerebri media' },
            { set: 18, label: '9', answer: 'a vertebralis' },
            { set: 18, label: '10', answer: 'n. opticus (n. II)' },
            { set: 18, label: '11', answer: 'hypophysis' },
            { set: 18, label: '12', answer: 'n. oculomotorius (n. III)' },
            { set: 18, label: '13', answer: 'n. trigeminus (n. V)' },
            { set: 18, label: '14', answer: 'n. abducens (n. VI)' },
            { set: 18, label: '15', answer: 'n. hypoglossus (n. XII)' },
            { set: 18, label: '16', answer: 'pons' },
            { set: 18, label: '17', answer: 'corpus mammillare' },
            { set: 18, label: '18', answer: 'floccus' },
            { set: 19, label: '1', answer: 'a. cerebri anterior' },
            { set: 19, label: '2', answer: 'a. carotis interna' },
            { set: 19, label: '3', answer: 'a. cerebelli superior' },
            { set: 19, label: '4', answer: 'a. basilaris' },
            { set: 19, label: '5', answer: 'a. cerebelli inferior anterior (AICA)' },
            { set: 19, label: '6', answer: 'a. vertebralis' },
            { set: 19, label: '7', answer: 'a. cerebelli inferior posterior (PICA)' },
            { set: 20, label: '1', answer: 'dura mater spinalis' },
            { set: 20, label: '2', answer: 'arachnoidea spinalis' },
            { set: 20, label: '3', answer: 'pia mater spinalis' },
            { set: 20, label: '4', answer: 'ligamentum denticulatum' },
            { set: 20, label: '5', answer: 'spatium subarachnoidale' },
            { set: 20, label: '6', answer: 'a. spinalis anterior' },
            { set: 20, label: '7', answer: 'a. spinalis posterior' },
            { set: 20, label: '8', answer: 'spatium subdurale' },
            { set: 20, label: '9', answer: 'radix anterior' },
            { set: 20, label: '10', answer: 'radix posterior' },
            { set: 21, label: '1', answer: 'sinus sagittalis superior' },
            { set: 21, label: '2', answer: 'sinus sagittalis inferior' },
            { set: 21, label: '3', answer: 'H√ñGER sinus rectus' },
            { set: 21, label: '4', answer: 'V√ÑNSTER sinus rektus' },
            { set: 21, label: '5', answer: 'H√ñGER confluens sinuum' },
            { set: 21, label: '6', answer: 'V√ÑNSTER confluens sinuum' },
            { set: 21, label: '7', answer: 'sinus sphenoparietalis' },
            { set: 21, label: '8', answer: 'H√ñGER sinus transversus' },
            { set: 21, label: '9', answer: 'V√ÑNSTER sinus transversus' },
            { set: 21, label: '10', answer: 'V√ÑNSTER sinus sigmoideus' },
            { set: 21, label: '11', answer: 'H√ñGER sinus sigmoideus' },
            { set: 21, label: '12', answer: 'sinus cavernosus' },
            { set: 21, label: '13', answer: 'sinus petrosus superior' },
            { set: 21, label: '14', answer: 'foramen jugulare' },
            { set: 21, label: '15', answer: 'H√ñGER vena cerebrimagna' },
            { set: 21, label: '16', answer: 'V√ÑNSTER vena cerebrimagna' },
            { set: 22, label: '1', answer: 'cisterna cerebellomedullaris' },
            { set: 22, label: '2', answer: 'cisterna pontis' },
            { set: 22, label: '3', answer: 'cisterna interpeduncularis' },
            { set: 22, label: '4', answer: 'cisterna superior' },
            { set: 22, label: '5', answer: 'cisterna chiasmatis' },
            { set: 22, label: '6', answer: 'ryggm√§rgens subarachnoidalrum' },
            { set: 22, label: '7', answer: 'corpus callosum' },
            { set: 22, label: '8', answer: 'fornix' },
            { set: 22, label: '9', answer: 'thalamus' },
            { set: 22, label: '10', answer: 'mesencephalon' },
            { set: 22, label: '11', answer: 'aqueductus cerebri' },
            { set: 22, label: '12', answer: 'pons' },
            { set: 22, label: '13', answer: 'medulla oblongata' },
            { set: 22, label: '14', answer: 'fj√§rde ventrikeln' }
        ];

        // --- Global State Variables ---
        let questions = []; 
        let currentQuestionIndex = 0;
        let score = 0;
        let quizActive = false;
        
        // Image link setup (Corrected Raw GitHub Content)
        const IMAGE_BASE_URL = 'https://raw.githubusercontent.com/dddjy577/neuroanatomyquiz/main/'; 
        // Max set number is 22, derived from the QUIZ_DATA
        const MAX_SET = 22;

        // --- Utility Functions ---

        function normalizeAnswer(text) {
            return text.toLowerCase().trim().replace(/[\.,\(\)\-\*]/g, '').replace(/\s+/g, ' ');
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Function to populate the set dropdown
        function populateSetDropdown() {
            const dropdown = document.getElementById('set-dropdown');
            for (let i = 1; i <= MAX_SET; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Set ${i}`;
                dropdown.appendChild(option);
            }
        }
        
        // FUNCTION MODIFIED TO ONLY START IN 'ORDERED' MODE
        function jumpToSet() {
            const startSet = parseInt(document.getElementById('set-dropdown').value);
            if (startSet >= 1 && startSet <= MAX_SET) {
                // Force 'ordered' mode when jumping to a set
                startQuiz('ordered', startSet);
            } else {
                alert('Please select a valid set number.');
            }
        }


        // --- Core Quiz Logic ---
        
        // startQuiz handles the optional startSet parameter
        function startQuiz(mode, startSet = 1) {
            // Filter questions to include only those starting from the selected set
            questions = QUIZ_DATA.filter(q => q.set >= startSet); 

            if (questions.length === 0) {
                alert(`No questions found starting from Set ${startSet}.`);
                return;
            }

            if (mode === 'random') {
                shuffle(questions);
            } else {
                // For ordered mode, sort them by set and then label
                questions.sort((a, b) => {
                    if (a.set !== b.set) {
                        return a.set - b.set;
                    }
                    // Sort by label for questions within the same set (e.g., '1' < '2' < 'a' < 'b')
                    return String(a.label).localeCompare(String(b.label));
                });
            }

            currentQuestionIndex = 0;
            score = 0;
            quizActive = true;

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';

            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                // If all questions are done, call endQuiz without a specific count (defaults to total)
                endQuiz();
                return;
            }

            const q = questions[currentQuestionIndex];
            
            const imageUrl = `${IMAGE_BASE_URL}set${q.set}pic.jpg`; 

            // Reset UI
            document.getElementById('image-display').innerHTML = `<img src="${imageUrl}" alt="Neuroanatomy image from Set ${q.set}" onerror="this.onerror=null; this.src='https://via.placeholder.com/600x400?text=Image+Not+Found+-+Check+GitHub+Repo';">`;
            document.getElementById('question-text').textContent = `What is label ${q.label} in Set ${q.set} pic?`;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('submit-button').style.display = 'inline-block';
            document.getElementById('next-button').style.display = 'none';
            document.getElementById('result-message').textContent = '';
            document.getElementById('result-message').className = '';
            document.getElementById('answer-input').focus();

            updateInfoBar();
        }
        
        function updateInfoBar() {
            document.getElementById('score').textContent = `Correct: ${score}`;
            document.getElementById('progress').textContent = `Question: ${currentQuestionIndex + 1}/${questions.length}`;
        }

        function checkAnswer() {
            if (!quizActive) return;

            const q = questions[currentQuestionIndex];
            const userAnswer = document.getElementById('answer-input').value;
            const correctAnswer = q.answer;
            
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(correctAnswer); 
            
            const resultMessage = document.getElementById('result-message');

            if (normalizedUser === normalizedCorrect) {
                if (!q.isCorrect) {
                    score++;
                    q.isCorrect = true; // Mark question as correctly answered
                }
                
                resultMessage.className = 'correct';
                resultMessage.textContent = '‚úÖ Correct! Well done.';

            } else {
                resultMessage.className = 'wrong';
                resultMessage.innerHTML = `‚ùå Wrong. The correct answer is: <strong>${correctAnswer}</strong>.`;
                q.isCorrect = false; // Mark question as incorrectly answered
            }
            
            // Mark the question as attempted
            q.isAttempted = true;

            document.getElementById('answer-input').disabled = true;
            document.getElementById('submit-button').style.display = 'none';
            document.getElementById('next-button').style.display = 'inline-block';
            updateInfoBar();
        }

        function nextQuestion() {
            if (!quizActive) return;
            currentQuestionIndex++;
            loadQuestion();
        }
        
        // Function called by the new "End Quiz" button
        function endQuizEarly() {
            if (!quizActive) return;
            
            // The number of questions seen is the current index + 1
            const totalSeen = currentQuestionIndex + 1;
            
            // Call the shared end function with the number of questions seen
            endQuiz(totalSeen); 
        }

        // Shared function for ending the quiz (either naturally or early)
        function endQuiz(totalSeenQuestions = questions.length) {
            quizActive = false;
            document.getElementById('quiz-screen').style.display = 'none';
            
            // Calculate percentage
            const percentage = totalSeenQuestions > 0 ? ((score / totalSeenQuestions) * 100).toFixed(1) : 0;
            
            let finalMessage = document.getElementById('final-message');
            if (!finalMessage) {
                finalMessage = document.createElement('div');
                finalMessage.id = 'final-message';
                document.getElementById('quiz-container').appendChild(finalMessage);
            }

            // Determine the message based on whether the quiz finished naturally or was ended early
            const title = totalSeenQuestions === questions.length ? "Quiz Finished! üéâ" : "Quiz Ended Early! üõë";

            finalMessage.innerHTML = `<h2>${title}</h2>
                                         <p>Total questions **seen** so far: <strong>${totalSeenQuestions}</strong></p>
                                         <p>Total questions answered **correctly**: <strong>${score}</strong></p>
                                         <p>Your Score Percentage: <strong>${percentage}%</strong></p>
                                         <button class="start-button" onclick="window.location.reload()">Start Over</button>`;
        }

        // Add event listener for 'Enter' key press on the input field
        document.addEventListener('DOMContentLoaded', () => {
            // Populate the dropdown when the page loads
            populateSetDropdown();
            
            const answerInput = document.getElementById('answer-input');
            const nextButton = document.getElementById('next-button');
            const submitButton = document.getElementById('submit-button');

            if (answerInput) {
                answerInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        // If the submit button is visible, submit the answer
                        if (submitButton.style.display !== 'none' && !answerInput.disabled) {
                            checkAnswer();
                        } 
                        // If the next button is visible, go to the next question
                        else if (nextButton.style.display !== 'none') {
                            nextQuestion();
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
